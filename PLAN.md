# Скелет проекта
- Сформировать структуру `src/` с модулями конфигурации, моделей, клиента SGR, рендера заметок, записи файлов и Telegram-бота.
- Настроить `pyproject.toml` под aiogram 3, pydantic v2, openai/SGR SDK, pytest и утилиты (python-dotenv, slugify и т.д.).
- Добавить `.env.example` и базовый `config.py` с чтением токенов, путей и таймзоны через pydantic-settings.
- Подготовить директории `cache/`, `tests/`, `scripts/` (для CLI) и описать их назначение в README.

# Модели и SGR-схемы
- Реализовать `TimeEntry` и `TimeNote` на Pydantic с описаниями полей из PROJECT_DESCRIPTION, включая Literal для maintag.
- Сгенерировать JSON Schema для `TimeEntry` и сохранить рядом (например, `schemas/time_entry.json`) для передачи в SGR.
- Описать system- и user-промпты, фиксирующие правила разбора и маппинга maintag/subtag, и добавить тестовые примеры в документацию.

# Клиент SGR
- Создать `sgr_client.py` с функцией `parse_time_entry_with_sgr(message_text: str, today: date) -> TimeEntry`, оборачивающей `chat_sgr_parse`.
- Вынести подготовку входного JSON (`raw_text`, `date`) и генерацию сообщений (system/user) в отдельные функции для тестируемости.
- Добавить логирование и кэширование ответов в `cache/time_entries.jsonl`, чтобы фиксировать примеры и упрощать отладку.

# Рендеринг Obsidian-заметки
- Реализовать `build_time_note(entry, base_dir)` для генерации `note_id`, имени файла `<slug> YYYY-MM-DD HH-MM.md`, пути и `created_at`.
- Добавить slugifier, использование `start_time` или текущего времени и защиту от дублей (суффикс/UUID).
- Написать `note_renderer.render_markdown()` по образцу из PROJECT_DESCRIPTION и `obsidian_writer.write_note_file()` с атомарной записью.

# Локальный CLI
- Создать модуль `cli.py`/`__main__.py`, который принимает текст, гоняет пайплайн (парсер → note → markdown) и выводит результат/пишет файл.
- Добавить опцию dry-run (только вывод в stdout) и параметр пути к vault для ручной проверки.
- Описать usage в README и сделать make/uv скрипт (`uv run python -m time_bot.cli "..."`).

# Тесты
- Подготовить `tests/data/time_messages_samples.jsonl` с наборами вход→ожидание из PROJECT_DESCRIPTION.
- Написать юнит-тесты для slug/имени файла, рендера Markdown и сборки `TimeNote`.
- Замокать SGR в интеграционных тестах пайплайна, проверяя, что CLI и writer формируют правильные файлы без реальных запросов.

# Интеграция с Telegram
- Настроить aiogram 3 (бот, диспетчер, middlewares) и базовые хендлеры `/start`, `/help`, текстовых сообщений.
- Подключить пайплайн: получение текста → `parse_time_entry_with_sgr` → построение заметки → запись файла → ответ пользователю с краткой сводкой.
- Добавить обработку ошибок (SGRParseError, IOErrors) и сообщения-подсказки для пользователя.

# Дополнительные фичи
- Реализовать команды `/today`, `/stats`, `/last`, используя промежуточное хранение/чтение заметок.
- Добавить предпросмотр заметки и подтверждение перед записью, а также возможность /edit_last.
- Настроить базовое логирование, трейсинг и уведомления об ошибках (например, в отдельный чат или файл).

# Деплой и эксплуатация
- Подготовить инструкции по запуску (uv run/systemd/Docker), включая монтирование Obsidian vault и переменные окружения.
- Настроить скрипт или сервис для автоперезапуска бота, лог-файлы и мониторинг доступности.
- Описать процедуру обновления моделей/промптов и бэкапа сохранённых заметок.
